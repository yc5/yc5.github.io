<!doctype html>
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>懇請賜票：Gatsby 創意大賞 by 台灣鄭雅云團隊</title>
    <meta name="Description" content="使用這套系統投票，您只需要點一下投票按鈕，可以節省尋找作品的時間。">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">

    <!-- Facebook OG -->
    <meta property="og:title" content="懇請賜票：Gatsby 創意大賞 by 台灣鄭雅云團隊" />
    <meta property="og:description" content="使用這套系統投票，您只需要點一下投票按鈕，可以節省尋找作品的時間。" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://yc5.github.io/gatsby2018/" />
    <meta property="og:image" content="https://yc5.github.io/gatsby2018/shot1.png" />

    <style>
     *{
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
     }
     body {
        padding-top: 5rem;
      }
      .starter-template {
        padding: 3rem 1.5rem;
        text-align: center;
      }
      .flag{
        width: 1.25em;
        display: inline-block;
        line-height: 24px;
        vertical-align: baseline;
        padding-right: 4px;
      }
      h3{
        line-height: 24px;
        font-size-adjust: 100%;
        
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="#">幫幫投個票</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">台灣鄭雅云團隊 <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link">識別碼：<span id="text_nonce"></span></a>
          </li>
        </ul>
      </div>

      <span class="navbar-text" style="margin-right: 1em">
        目前的IP為：<span id="text_ip">取得中...</span>
      </span>
      <span class="navbar-text">
        <span id="text_votes"></span>
      </span>
    </nav>

    <main role="main" class="container">

      <div class="starter-template">
        <h1>Gatsby 創意大賞 by 台灣鄭雅云團隊</h1>
        <!-- <p class="lead">使用這套系統投票，您只需要點一下投票按鈕，可以節省尋找作品的時間。投票票數一個IP僅計算一次。</p> -->
        <p class="lead">請幫我們按一下投票按鈕，當成功訊息跳出即完成投票，投票票數一個IP僅計算一次，感激不盡。</p>
        
        <p>
          <button type="button" class="btn btn-primary btn-lg btn-block" id="vote">投票</button>
          
        </p>
        <p id="msg"></p>

        <div class="row">
        <div class="col-md-6">
        <div class="card">
        <div class="card-header">說明</div>
        <div class="card-body">
        <h5 class="card-title">【資友幫幫忙 ☞ Gatsby Creative awards】</h5>
        <p class="card-text">
        各位!!!
        <br>今年gatsby影片競賽系上學生又入圍了!!!
        <br>需要大家幫忙衝網路投票將他們送去日本比賽!
        <br>亞洲區12國取1，那個1希望就是台灣啊!
        <br>
        <br>・投票期間：2018年11月16日(五) - 2018年12月3日(一)
        <br>
        <br>請認明CM組『🇹🇼 鄭雅云』
        <br>電腦、手機、平板都可以投，麻煩了~
        <br>
        <br>懇請支持!拜託拜託!</p>
        </div>
        </div>
        </div>

        <div class="col-md-6">
        <a href="https://award.gatsby.jp/wp/wp-content/themes/gca/lib/work/cm/tw/2017.mp4" target="_blank">
          <img src="shot1.png" class="img-thumbnail" alt="">
        </a>
        <h3 class="h5"><img class="flag" src="https://award.gatsby.jp/wp/wp-content/themes/gca/lib/img/common/flag/tw.png">鄭雅云<a href="https://award.gatsby.jp/tw/vote/cm/" target="_blank">造訪Gatsby原始網站</a></h3>
        </div>
        </div>
      </div>

    </main><!-- /.container -->

    <footer class="text-muted">
      <div class="container">
        <p class="float-right">
          <a href="https://xstar.me">XSTAR Studio</a>
        </p>
        <p>&copy; 2018 xSTAR Studio</p>
      </div>
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <script>
    jQuery(document).ready(function(){
      var vote_times = 0;
      var nonce = "7b8a84f604";
      $("#text_nonce").text(nonce);
      $("button#vote").click(function( event ){
        // if(vote_times>0){get_current_ip();}
        get_current_ip();

        // Stop form from submitting normally
        event.preventDefault();
       
        // Get some values from elements on the page:
        var url = "https://award.gatsby.jp/wp/wp-admin/admin-ajax.php";
       
        // Send the data using post
        var posting = jQuery.ajax({
             type : "post",
             dataType : "json",
             url : url,
             data : {action: "wti_like_post_process_vote", task : "like", post_id : "2598", nonce: nonce}
        });

        var $this = $(this);
        $this.text("正在傳送投票請求");
        $this.attr("disabled", true);
        
        // Put the results in a div
        posting.done(function( data ) {
          $("p#msg").append("<div class='alert alert-success' role='alert'> "+"投票成功，Gatsby已開放CROS。"+" </div>");
        });
        posting.fail(function(){
          // Show success message
          var msg_success =  $("<div></div>").text("投票成功，謝謝你的幫忙！");
          msg_success.addClass("alert alert-success");
          msg_success.attr("role", "alert");
          $("p#msg").append(msg_success);
          msg_success.delay(5500).fadeOut(300, function(){ $(this).remove();});
          
          // var tmp = get_votes_amount(); // Async problem
          // $this.after("<button type='button' class='btn btn-warning btn-lg btn-block' id='revote'>不同IP重投</button>");
          // $("button#revote").bind("click", revote);
          $this.text("以不同IP重投");
          $this.attr("disabled", false);
          $this.removeClass("btn-primary");
          $this.addClass("btn-warning");
          get_votes_amount();
          vote_times++;
        });
      });
      $("button#vote").click();
    }); //jQuery
    
    // JS get IP
    function get_current_ip(){
      $.getJSON('https://api.ipify.org/?format=json', function(data) {
        $("#text_ip").text(data.ip);
      }).fail(function() {
        $("#text_ip").text("無法取得");
      });
    };
    // get_current_ip();

    // Get votes amount
    function get_votes_amount(){
      var v =  "Unknown";
      $.ajax({
          url: "https://xstar.me/to/20181110-g/handle.php", 
          cache: false,
          success: function(response) {
              result = $(response).find(".lc-2598.lc");
              nonce = $(response).find(".like-2598").data("nonce");
              v = result[0].textContent;
              $("#text_votes").text("目前票數：" + v);
              $("#text_nonce").text(nonce);
          }
      });
    }
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-24449663-8"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-24449663-8');
	</script>
  </body>
</html>